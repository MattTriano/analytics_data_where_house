{{ config(materialized='view') }}
{% set ck_cols = ["geo_id"] %}
{% set record_id = "geo_id" %}

WITH records_with_basic_cleaning AS (
    SELECT
        upper(geo_id::text)           AS geo_id,
        upper(name::text)             AS name,
        b08124_001e::bigint           AS b08124_001e,
        upper(b08124_001ea::text)     AS b08124_001ea,
        b08124_001m::bigint           AS b08124_001m,
        upper(b08124_001ma::text)     AS b08124_001ma,
        b08124_002e::bigint           AS b08124_002e,
        upper(b08124_002ea::text)     AS b08124_002ea,
        b08124_002m::bigint           AS b08124_002m,
        upper(b08124_002ma::text)     AS b08124_002ma,
        b08124_003e::bigint           AS b08124_003e,
        upper(b08124_003ea::text)     AS b08124_003ea,
        b08124_003m::bigint           AS b08124_003m,
        upper(b08124_003ma::text)     AS b08124_003ma,
        b08124_004e::bigint           AS b08124_004e,
        upper(b08124_004ea::text)     AS b08124_004ea,
        b08124_004m::bigint           AS b08124_004m,
        upper(b08124_004ma::text)     AS b08124_004ma,
        b08124_005e::bigint           AS b08124_005e,
        upper(b08124_005ea::text)     AS b08124_005ea,
        b08124_005m::bigint           AS b08124_005m,
        upper(b08124_005ma::text)     AS b08124_005ma,
        b08124_006e::bigint           AS b08124_006e,
        upper(b08124_006ea::text)     AS b08124_006ea,
        b08124_006m::bigint           AS b08124_006m,
        upper(b08124_006ma::text)     AS b08124_006ma,
        b08124_007e::bigint           AS b08124_007e,
        upper(b08124_007ea::text)     AS b08124_007ea,
        b08124_007m::bigint           AS b08124_007m,
        upper(b08124_007ma::text)     AS b08124_007ma,
        b08124_008e::bigint           AS b08124_008e,
        upper(b08124_008ea::text)     AS b08124_008ea,
        b08124_008m::bigint           AS b08124_008m,
        upper(b08124_008ma::text)     AS b08124_008ma,
        b08124_009e::bigint           AS b08124_009e,
        upper(b08124_009ea::text)     AS b08124_009ea,
        b08124_009m::bigint           AS b08124_009m,
        upper(b08124_009ma::text)     AS b08124_009ma,
        b08124_010e::bigint           AS b08124_010e,
        upper(b08124_010ea::text)     AS b08124_010ea,
        b08124_010m::bigint           AS b08124_010m,
        upper(b08124_010ma::text)     AS b08124_010ma,
        b08124_011e::bigint           AS b08124_011e,
        upper(b08124_011ea::text)     AS b08124_011ea,
        b08124_011m::bigint           AS b08124_011m,
        upper(b08124_011ma::text)     AS b08124_011ma,
        b08124_012e::bigint           AS b08124_012e,
        upper(b08124_012ea::text)     AS b08124_012ea,
        b08124_012m::bigint           AS b08124_012m,
        upper(b08124_012ma::text)     AS b08124_012ma,
        b08124_013e::bigint           AS b08124_013e,
        upper(b08124_013ea::text)     AS b08124_013ea,
        b08124_013m::bigint           AS b08124_013m,
        upper(b08124_013ma::text)     AS b08124_013ma,
        b08124_014e::bigint           AS b08124_014e,
        upper(b08124_014ea::text)     AS b08124_014ea,
        b08124_014m::bigint           AS b08124_014m,
        upper(b08124_014ma::text)     AS b08124_014ma,
        b08124_015e::bigint           AS b08124_015e,
        upper(b08124_015ea::text)     AS b08124_015ea,
        b08124_015m::bigint           AS b08124_015m,
        upper(b08124_015ma::text)     AS b08124_015ma,
        b08124_016e::bigint           AS b08124_016e,
        upper(b08124_016ea::text)     AS b08124_016ea,
        b08124_016m::bigint           AS b08124_016m,
        upper(b08124_016ma::text)     AS b08124_016ma,
        b08124_017e::bigint           AS b08124_017e,
        upper(b08124_017ea::text)     AS b08124_017ea,
        b08124_017m::bigint           AS b08124_017m,
        upper(b08124_017ma::text)     AS b08124_017ma,
        b08124_018e::bigint           AS b08124_018e,
        upper(b08124_018ea::text)     AS b08124_018ea,
        b08124_018m::bigint           AS b08124_018m,
        upper(b08124_018ma::text)     AS b08124_018ma,
        b08124_019e::bigint           AS b08124_019e,
        upper(b08124_019ea::text)     AS b08124_019ea,
        b08124_019m::bigint           AS b08124_019m,
        upper(b08124_019ma::text)     AS b08124_019ma,
        b08124_020e::bigint           AS b08124_020e,
        upper(b08124_020ea::text)     AS b08124_020ea,
        b08124_020m::bigint           AS b08124_020m,
        upper(b08124_020ma::text)     AS b08124_020ma,
        b08124_021e::bigint           AS b08124_021e,
        upper(b08124_021ea::text)     AS b08124_021ea,
        b08124_021m::bigint           AS b08124_021m,
        upper(b08124_021ma::text)     AS b08124_021ma,
        b08124_022e::bigint           AS b08124_022e,
        upper(b08124_022ea::text)     AS b08124_022ea,
        b08124_022m::bigint           AS b08124_022m,
        upper(b08124_022ma::text)     AS b08124_022ma,
        b08124_023e::bigint           AS b08124_023e,
        upper(b08124_023ea::text)     AS b08124_023ea,
        b08124_023m::bigint           AS b08124_023m,
        upper(b08124_023ma::text)     AS b08124_023ma,
        b08124_024e::bigint           AS b08124_024e,
        upper(b08124_024ea::text)     AS b08124_024ea,
        b08124_024m::bigint           AS b08124_024m,
        upper(b08124_024ma::text)     AS b08124_024ma,
        b08124_025e::bigint           AS b08124_025e,
        upper(b08124_025ea::text)     AS b08124_025ea,
        b08124_025m::bigint           AS b08124_025m,
        upper(b08124_025ma::text)     AS b08124_025ma,
        b08124_026e::bigint           AS b08124_026e,
        upper(b08124_026ea::text)     AS b08124_026ea,
        b08124_026m::bigint           AS b08124_026m,
        upper(b08124_026ma::text)     AS b08124_026ma,
        b08124_027e::bigint           AS b08124_027e,
        upper(b08124_027ea::text)     AS b08124_027ea,
        b08124_027m::bigint           AS b08124_027m,
        upper(b08124_027ma::text)     AS b08124_027ma,
        b08124_028e::bigint           AS b08124_028e,
        upper(b08124_028ea::text)     AS b08124_028ea,
        b08124_028m::bigint           AS b08124_028m,
        upper(b08124_028ma::text)     AS b08124_028ma,
        b08124_029e::bigint           AS b08124_029e,
        upper(b08124_029ea::text)     AS b08124_029ea,
        b08124_029m::bigint           AS b08124_029m,
        upper(b08124_029ma::text)     AS b08124_029ma,
        b08124_030e::bigint           AS b08124_030e,
        upper(b08124_030ea::text)     AS b08124_030ea,
        b08124_030m::bigint           AS b08124_030m,
        upper(b08124_030ma::text)     AS b08124_030ma,
        b08124_031e::bigint           AS b08124_031e,
        upper(b08124_031ea::text)     AS b08124_031ea,
        b08124_031m::bigint           AS b08124_031m,
        upper(b08124_031ma::text)     AS b08124_031ma,
        b08124_032e::bigint           AS b08124_032e,
        upper(b08124_032ea::text)     AS b08124_032ea,
        b08124_032m::bigint           AS b08124_032m,
        upper(b08124_032ma::text)     AS b08124_032ma,
        b08124_033e::bigint           AS b08124_033e,
        upper(b08124_033ea::text)     AS b08124_033ea,
        b08124_033m::bigint           AS b08124_033m,
        upper(b08124_033ma::text)     AS b08124_033ma,
        b08124_034e::bigint           AS b08124_034e,
        upper(b08124_034ea::text)     AS b08124_034ea,
        b08124_034m::bigint           AS b08124_034m,
        upper(b08124_034ma::text)     AS b08124_034ma,
        b08124_035e::bigint           AS b08124_035e,
        upper(b08124_035ea::text)     AS b08124_035ea,
        b08124_035m::bigint           AS b08124_035m,
        upper(b08124_035ma::text)     AS b08124_035ma,
        b08124_036e::bigint           AS b08124_036e,
        upper(b08124_036ea::text)     AS b08124_036ea,
        b08124_036m::bigint           AS b08124_036m,
        upper(b08124_036ma::text)     AS b08124_036ma,
        b08124_037e::bigint           AS b08124_037e,
        upper(b08124_037ea::text)     AS b08124_037ea,
        b08124_037m::bigint           AS b08124_037m,
        upper(b08124_037ma::text)     AS b08124_037ma,
        b08124_038e::bigint           AS b08124_038e,
        upper(b08124_038ea::text)     AS b08124_038ea,
        b08124_038m::bigint           AS b08124_038m,
        upper(b08124_038ma::text)     AS b08124_038ma,
        b08124_039e::bigint           AS b08124_039e,
        upper(b08124_039ea::text)     AS b08124_039ea,
        b08124_039m::bigint           AS b08124_039m,
        upper(b08124_039ma::text)     AS b08124_039ma,
        b08124_040e::bigint           AS b08124_040e,
        upper(b08124_040ea::text)     AS b08124_040ea,
        b08124_040m::bigint           AS b08124_040m,
        upper(b08124_040ma::text)     AS b08124_040ma,
        b08124_041e::bigint           AS b08124_041e,
        upper(b08124_041ea::text)     AS b08124_041ea,
        b08124_041m::bigint           AS b08124_041m,
        upper(b08124_041ma::text)     AS b08124_041ma,
        b08124_042e::bigint           AS b08124_042e,
        upper(b08124_042ea::text)     AS b08124_042ea,
        b08124_042m::bigint           AS b08124_042m,
        upper(b08124_042ma::text)     AS b08124_042ma,
        b08124_043e::bigint           AS b08124_043e,
        upper(b08124_043ea::text)     AS b08124_043ea,
        b08124_043m::bigint           AS b08124_043m,
        upper(b08124_043ma::text)     AS b08124_043ma,
        b08124_044e::bigint           AS b08124_044e,
        upper(b08124_044ea::text)     AS b08124_044ea,
        b08124_044m::bigint           AS b08124_044m,
        upper(b08124_044ma::text)     AS b08124_044ma,
        b08124_045e::bigint           AS b08124_045e,
        upper(b08124_045ea::text)     AS b08124_045ea,
        b08124_045m::bigint           AS b08124_045m,
        upper(b08124_045ma::text)     AS b08124_045ma,
        b08124_046e::bigint           AS b08124_046e,
        upper(b08124_046ea::text)     AS b08124_046ea,
        b08124_046m::bigint           AS b08124_046m,
        upper(b08124_046ma::text)     AS b08124_046ma,
        b08124_047e::bigint           AS b08124_047e,
        upper(b08124_047ea::text)     AS b08124_047ea,
        b08124_047m::bigint           AS b08124_047m,
        upper(b08124_047ma::text)     AS b08124_047ma,
        b08124_048e::bigint           AS b08124_048e,
        upper(b08124_048ea::text)     AS b08124_048ea,
        b08124_048m::bigint           AS b08124_048m,
        upper(b08124_048ma::text)     AS b08124_048ma,
        b08124_049e::bigint           AS b08124_049e,
        upper(b08124_049ea::text)     AS b08124_049ea,
        b08124_049m::bigint           AS b08124_049m,
        upper(b08124_049ma::text)     AS b08124_049ma,
        upper(state::text)            AS state,
        upper(county::text)           AS county,
        upper(tract::text)            AS tract,
        upper(dataset_base_url::text) AS dataset_base_url,
        dataset_id::bigint            AS dataset_id,
        source_data_updated::timestamptz
            AT TIME ZONE 'UTC' AT TIME ZONE 'America/Chicago' AS source_data_updated,
        ingestion_check_time::timestamptz
            AT TIME ZONE 'UTC' AT TIME ZONE 'America/Chicago' AS ingestion_check_time
    FROM {{ ref('cc_transportation_to_work_by_occ_by_tract') }}
    ORDER BY {% for ck in ck_cols %}{{ ck }}{{ "," if not loop.last }}{% endfor %}
)


SELECT
    {% if ck_cols|length > 1 %}
        {{ dbt_utils.generate_surrogate_key(ck_cols) }} AS {{ record_id }},
    {% endif %}
    a.*
FROM records_with_basic_cleaning AS a
ORDER BY {% for ck in ck_cols %}{{ ck }},{% endfor %} source_data_updated
