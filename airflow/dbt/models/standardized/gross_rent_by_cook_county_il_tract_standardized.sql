{{ config(materialized='view') }}
{% set ck_cols = ["geo_id"] %}
{% set record_id = "geo_id" %}

WITH records_with_basic_cleaning AS (
    SELECT
        upper(geo_id::text)           AS geo_id,
        upper(name::text)             AS name,
        b25063_001e::bigint           AS b25063_001e,
        upper(b25063_001ea::text)     AS b25063_001ea,
        b25063_001m::bigint           AS b25063_001m,
        upper(b25063_001ma::text)     AS b25063_001ma,
        b25063_002e::bigint           AS b25063_002e,
        upper(b25063_002ea::text)     AS b25063_002ea,
        b25063_002m::bigint           AS b25063_002m,
        upper(b25063_002ma::text)     AS b25063_002ma,
        b25063_003e::bigint           AS b25063_003e,
        upper(b25063_003ea::text)     AS b25063_003ea,
        b25063_003m::bigint           AS b25063_003m,
        upper(b25063_003ma::text)     AS b25063_003ma,
        b25063_004e::bigint           AS b25063_004e,
        upper(b25063_004ea::text)     AS b25063_004ea,
        b25063_004m::bigint           AS b25063_004m,
        upper(b25063_004ma::text)     AS b25063_004ma,
        b25063_005e::bigint           AS b25063_005e,
        upper(b25063_005ea::text)     AS b25063_005ea,
        b25063_005m::bigint           AS b25063_005m,
        upper(b25063_005ma::text)     AS b25063_005ma,
        b25063_006e::bigint           AS b25063_006e,
        upper(b25063_006ea::text)     AS b25063_006ea,
        b25063_006m::bigint           AS b25063_006m,
        upper(b25063_006ma::text)     AS b25063_006ma,
        b25063_007e::bigint           AS b25063_007e,
        upper(b25063_007ea::text)     AS b25063_007ea,
        b25063_007m::bigint           AS b25063_007m,
        upper(b25063_007ma::text)     AS b25063_007ma,
        b25063_008e::bigint           AS b25063_008e,
        upper(b25063_008ea::text)     AS b25063_008ea,
        b25063_008m::bigint           AS b25063_008m,
        upper(b25063_008ma::text)     AS b25063_008ma,
        b25063_009e::bigint           AS b25063_009e,
        upper(b25063_009ea::text)     AS b25063_009ea,
        b25063_009m::bigint           AS b25063_009m,
        upper(b25063_009ma::text)     AS b25063_009ma,
        b25063_010e::bigint           AS b25063_010e,
        upper(b25063_010ea::text)     AS b25063_010ea,
        b25063_010m::bigint           AS b25063_010m,
        upper(b25063_010ma::text)     AS b25063_010ma,
        b25063_011e::bigint           AS b25063_011e,
        upper(b25063_011ea::text)     AS b25063_011ea,
        b25063_011m::bigint           AS b25063_011m,
        upper(b25063_011ma::text)     AS b25063_011ma,
        b25063_012e::bigint           AS b25063_012e,
        upper(b25063_012ea::text)     AS b25063_012ea,
        b25063_012m::bigint           AS b25063_012m,
        upper(b25063_012ma::text)     AS b25063_012ma,
        b25063_013e::bigint           AS b25063_013e,
        upper(b25063_013ea::text)     AS b25063_013ea,
        b25063_013m::bigint           AS b25063_013m,
        upper(b25063_013ma::text)     AS b25063_013ma,
        b25063_014e::bigint           AS b25063_014e,
        upper(b25063_014ea::text)     AS b25063_014ea,
        b25063_014m::bigint           AS b25063_014m,
        upper(b25063_014ma::text)     AS b25063_014ma,
        b25063_015e::bigint           AS b25063_015e,
        upper(b25063_015ea::text)     AS b25063_015ea,
        b25063_015m::bigint           AS b25063_015m,
        upper(b25063_015ma::text)     AS b25063_015ma,
        b25063_016e::bigint           AS b25063_016e,
        upper(b25063_016ea::text)     AS b25063_016ea,
        b25063_016m::bigint           AS b25063_016m,
        upper(b25063_016ma::text)     AS b25063_016ma,
        b25063_017e::bigint           AS b25063_017e,
        upper(b25063_017ea::text)     AS b25063_017ea,
        b25063_017m::bigint           AS b25063_017m,
        upper(b25063_017ma::text)     AS b25063_017ma,
        b25063_018e::bigint           AS b25063_018e,
        upper(b25063_018ea::text)     AS b25063_018ea,
        b25063_018m::bigint           AS b25063_018m,
        upper(b25063_018ma::text)     AS b25063_018ma,
        b25063_019e::bigint           AS b25063_019e,
        upper(b25063_019ea::text)     AS b25063_019ea,
        b25063_019m::bigint           AS b25063_019m,
        upper(b25063_019ma::text)     AS b25063_019ma,
        b25063_020e::bigint           AS b25063_020e,
        upper(b25063_020ea::text)     AS b25063_020ea,
        b25063_020m::bigint           AS b25063_020m,
        upper(b25063_020ma::text)     AS b25063_020ma,
        b25063_021e::bigint           AS b25063_021e,
        upper(b25063_021ea::text)     AS b25063_021ea,
        b25063_021m::bigint           AS b25063_021m,
        upper(b25063_021ma::text)     AS b25063_021ma,
        b25063_022e::bigint           AS b25063_022e,
        upper(b25063_022ea::text)     AS b25063_022ea,
        b25063_022m::bigint           AS b25063_022m,
        upper(b25063_022ma::text)     AS b25063_022ma,
        b25063_023e::bigint           AS b25063_023e,
        upper(b25063_023ea::text)     AS b25063_023ea,
        b25063_023m::bigint           AS b25063_023m,
        upper(b25063_023ma::text)     AS b25063_023ma,
        b25063_024e::bigint           AS b25063_024e,
        upper(b25063_024ea::text)     AS b25063_024ea,
        b25063_024m::bigint           AS b25063_024m,
        upper(b25063_024ma::text)     AS b25063_024ma,
        b25063_025e::bigint           AS b25063_025e,
        upper(b25063_025ea::text)     AS b25063_025ea,
        b25063_025m::bigint           AS b25063_025m,
        upper(b25063_025ma::text)     AS b25063_025ma,
        b25063_026e::bigint           AS b25063_026e,
        upper(b25063_026ea::text)     AS b25063_026ea,
        b25063_026m::bigint           AS b25063_026m,
        upper(b25063_026ma::text)     AS b25063_026ma,
        b25063_027e::bigint           AS b25063_027e,
        upper(b25063_027ea::text)     AS b25063_027ea,
        b25063_027m::bigint           AS b25063_027m,
        upper(b25063_027ma::text)     AS b25063_027ma,
        upper(state::text)            AS state,
        upper(county::text)           AS county,
        upper(tract::text)            AS tract,
        upper(dataset_base_url::text) AS dataset_base_url,
        dataset_id::bigint            AS dataset_id,
        source_data_updated::timestamptz
            AT TIME ZONE 'UTC' AT TIME ZONE 'America/Chicago' AS source_data_updated,
        ingestion_check_time::timestamptz
            AT TIME ZONE 'UTC' AT TIME ZONE 'America/Chicago' AS ingestion_check_time
    FROM {{ ref('gross_rent_by_cook_county_il_tract') }}
    ORDER BY {% for ck in ck_cols %}{{ ck }}{{ "," if not loop.last }}{% endfor %}
)


SELECT
    {% if ck_cols|length > 1 %}
        {{ dbt_utils.generate_surrogate_key(ck_cols) }} AS {{ record_id }},
    {% endif %}
    a.*
FROM records_with_basic_cleaning AS a
ORDER BY {% for ck in ck_cols %}{{ ck }},{% endfor %} source_data_updated
